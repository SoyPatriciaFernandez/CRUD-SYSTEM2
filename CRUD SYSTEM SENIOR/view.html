<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ver Producto</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>Detalle del Producto</h1>
    <div id="alerts"></div>
    <div id="loading" class="loading" style="display:none;">Cargando...</div>
    <div class="product-detail" id="product-detail">
      <!-- Los detalles del producto se cargarán aquí -->
    </div>
    <a href="index.html" class="btn">Volver</a>
  </div>
  <script type="module">
    import { db } from './firebase-config.js';
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    const alerts = document.getElementById('alerts');
    const loadingEl = document.getElementById('loading');

    function showAlert(message, type = 'info') {
      alerts.innerHTML = `<div class=\"alert alert-${type}\">${message}</div>`;
      setTimeout(() => { alerts.innerHTML = ''; }, 3000);
    }

    const currency = new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'USD' });

    function getIdFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    async function cargarProducto() {
      const id = getIdFromUrl();
      if (!id) {
        showAlert('ID no encontrado en la URL.', 'error');
        return;
      }
      loadingEl.style.display = '';
      try {
        const docRef = doc(db, 'productos', id);
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          const producto = docSnap.data();
          const precio = Number(producto.precio) || 0;
          const precioOriginal = Number(producto.precio_original) || 0;
          document.getElementById('product-detail').innerHTML = `
          <div class="product-info">
            <h2>${producto.nombre ?? ''}</h2>
            <p><strong>Precio:</strong> ${currency.format(precio)}</p>
            <p><strong>Precio Original:</strong> ${currency.format(precioOriginal)}</p>
            <p><strong>Descripción:</strong> ${producto.descripcion ?? ''}</p>
          </div>
        `;
        } else {
          document.getElementById('product-detail').innerHTML = '<p>Producto no encontrado.</p>';
        }
      } catch (error) {
        showAlert('Error al cargar el producto: ' + error.message, 'error');
      } finally {
        loadingEl.style.display = 'none';
      }
    }
    cargarProducto();
  </script>
</body>
</html> 